import{d as e,r as t,m as a,z as l,o,j as r,k as i,q as s,b as u,c as n,f as d,t as c,B as v,e as p}from"./index-BChQAjBg.js";import{_ as g}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_ as m}from"./AdminLayout-BDbNDvIA.js";import{_ as y}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{D as P}from"./DataTable-D4TLCeTz.js";import{L as h}from"./LazyImage-BMawgtWq.js";import{_}from"./Pagination-D-pp1c0D.js";import{P as f}from"./ProductsAPI-MABK5z0-.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ErrorIcon-CRM2J8oG.js";const x={class:"space-y-5 sm:space-y-6"},b={key:0,class:"text-center py-8"},A={key:1,class:"text-center py-8"},w={class:"text-red-500"},k=e({__name:"Products",setup(e){const k=v(),j=t("Products"),C=t([]),I=t(!1),N=t(""),T=t(""),q=t(""),D=t({currentPage:1,totalPages:1,totalDocuments:0,hasNextPage:!1,hasPrevPage:!1,limit:10}),$=t([{key:"imgCover",title:"Image",type:"text",widthClass:"w-20"},{key:"title",title:"Product Name",type:"text"},{key:"price",title:"Price",type:"text"},{key:"quantity",title:"Stock",type:"text"},{key:"isActive",title:"Status",type:"status",badgeType:"success"},{key:"ratingAvg",title:"Rating",type:"text"}]),L=a(()=>C.value.map(e=>{var t;return{...e,title:(null==(t=e.title)?void 0:t.en)||"No Title",price:`KD ${e.price||0}`,quantity:e.quantity||0,isActive:e.isActive?"Active":"Inactive",ratingAvg:e.ratingAvg?`${e.ratingAvg}/5`:"No Rating",imgCover:e.imgCover}})),R=async()=>{var e,t,a,l,o;I.value=!0,N.value="";try{const l={page:D.value.currentPage,limit:D.value.limit,keyword:T.value,fields:"_id,title,price,quantity,isActive,ratingAvg,ratingCount,imgCover"};q.value&&("active"===q.value?l.isActive=!0:"inactive"===q.value?l.isActive=!1:"out_of_stock"===q.value&&(l.quantity=0)),console.log("API Parameters being sent:",l);const o=await f.getAllProducts(l);console.log("Full API Response:",o),(null==(t=null==(e=o.data)?void 0:e.data)?void 0:t.products)&&Array.isArray(o.data.data.products)?(C.value=o.data.data.products,console.log("Products loaded:",C.value.length),o.data.data.pagination&&(D.value={...o.data.data.pagination})):(null==(a=o.data)?void 0:a.products)&&Array.isArray(o.data.products)?(C.value=o.data.products,console.log("Products loaded (alt structure):",C.value.length),D.value.totalPages=Math.ceil(o.data.products.length/D.value.limit)):(console.error("No products found in response:",o.data),C.value=[],D.value.totalPages=1)}catch(r){N.value=(null==(o=null==(l=r.response)?void 0:l.data)?void 0:o.message)||"Failed to load products",console.error("Error loading products:",r)}finally{I.value=!1}},E=e=>{D.value.currentPage=e,R()},F=e=>{(null==e?void 0:e._id)&&k.push(`/products/view/${e._id}`)},z=e=>{(null==e?void 0:e._id)&&k.push(`/products/edit/${e._id}`)},B=()=>{k.push("/products/edit/new")},S=async e=>{var t,a;if((null==e?void 0:e._id)&&confirm(`Are you sure you want to delete "${e.title}"?`))try{await f.deleteProduct(e._id),await R()}catch(l){N.value=(null==(a=null==(t=l.response)?void 0:t.data)?void 0:a.message)||"Failed to delete product",console.error("Error deleting product:",l)}};let K;return l(T,()=>{clearTimeout(K),K=setTimeout(()=>{D.value.currentPage=1,R()},500)}),l(q,()=>{D.value.currentPage=1,R()}),o(()=>{R()}),(e,t)=>(p(),r(m,null,{default:i(()=>[s(g,{pageTitle:j.value},null,8,["pageTitle"]),u("div",x,[s(y,{title:"Products"},{default:i(()=>[u("div",{class:"mb-4 flex justify-between items-center"},[u("button",{onClick:B,class:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-colors duration-200"}," + Add New Product ")]),I.value?(p(),n("div",b,[...t[0]||(t[0]=[u("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500 mx-auto"},null,-1),u("p",{class:"mt-2 text-gray-500"},"Loading products...",-1)])])):N.value?(p(),n("div",A,[u("p",w,c(N.value),1),u("button",{onClick:R,class:"mt-2 px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600"}," Retry ")])):(p(),r(P,{key:2,columns:$.value,data:L.value,"show-actions":!0,"on-view":F,"on-edit":z,"on-delete":S},{"column-imgCover":i(({item:e})=>[s(h,{"image-id":e.imgCover,alt:"Product image",width:"60px",height:"60px","image-class":"w-full h-full object-cover rounded",placeholder:"/placeholder-product.png"},null,8,["image-id"])]),_:1},8,["columns","data"])),D.value.totalPages>1?(p(),r(_,{key:3,"current-page":D.value.currentPage,"total-pages":D.value.totalPages,"total-documents":D.value.totalDocuments,limit:D.value.limit,"has-next-page":D.value.hasNextPage,"has-prev-page":D.value.hasPrevPage,onPageChange:E},null,8,["current-page","total-pages","total-documents","limit","has-next-page","has-prev-page"])):d("",!0)]),_:1})])]),_:1}))}});export{k as default};
