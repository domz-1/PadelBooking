import{d as e,r as t,m as a,z as r,o as s,j as l,k as u,q as n,b as o,c as i,f as d,w as c,A as p,n as m,l as g,t as x,B as y,e as b}from"./index-BChQAjBg.js";import{U as v}from"./UsersAPI-Z4wDRJSF.js";import{_ as k}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_ as h}from"./AdminLayout-BDbNDvIA.js";import{_ as f}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{D as _}from"./DataTable-D4TLCeTz.js";import{_ as w}from"./Pagination-D-pp1c0D.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ErrorIcon-CRM2J8oG.js";const P={class:"space-y-5 sm:space-y-6"},U={class:"mb-4"},A={class:"relative"},G={class:"mb-6 border-b border-gray-200 dark:border-gray-700"},j={class:"-mb-px flex space-x-8"},C={class:"ml-2 px-2 py-0.5 rounded-full text-xs bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300"},D={class:"ml-2 px-2 py-0.5 rounded-full text-xs bg-blue-100 dark:bg-blue-500/20 text-blue-600 dark:text-blue-400"},N={class:"ml-2 px-2 py-0.5 rounded-full text-xs bg-purple-100 dark:bg-purple-500/20 text-purple-600 dark:text-purple-400"},T={key:0,class:"flex justify-center items-center py-12"},S={class:"flex items-center gap-3"},$={class:"w-10 h-10 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700 flex items-center justify-center"},E={class:"text-sm font-medium text-gray-600 dark:text-gray-300"},B={class:"block font-medium text-gray-800 text-sm dark:text-white/90"},I=["title"],W={key:1,class:"block text-gray-400 text-xs dark:text-gray-500 italic"},z={class:"block text-gray-800 dark:text-white text-sm"},L=["title"],M={key:1,class:"block text-gray-400 text-xs dark:text-gray-500 italic"},R=e({__name:"Users",setup(e){const R=y(),V=t("Users"),q=t([]),F=t(!1),H=t("all"),J=t(""),K=t({currentPage:1,totalPages:1,totalDocuments:0,hasNextPage:!1,hasPrevPage:!1,limit:10}),O=e=>{var t;return e.email&&(e.email.includes("@temp.local")||e.email.startsWith("guest_")||(null==(t=e.name)?void 0:t.startsWith("Guest_")))},Q=e=>{var t;return e.name&&e.name.startsWith("Guest_")?`Guest ${(null==(t=e.name.split("_")[1])?void 0:t.substring(0,6))||""}`:e.name||"Guest User"},X=a(()=>q.value.map(e=>({...e,isGuest:O(e),displayName:O(e)?Q(e):e.name}))),Y=a(()=>X.value),Z=a(()=>{const e=[{key:"name",title:"Name",type:"custom"},{key:"role",title:"Role",type:"status"}];return"guest"===H.value?[...e,{key:"type",title:"Type",type:"status"},{key:"createdAt",title:"Created",type:"text"}]:"normal"===H.value?[...e,{key:"contact",title:"Contact",type:"custom"},{key:"status",title:"Status",type:"status"},{key:"createdAt",title:"Created",type:"text"}]:[...e,{key:"type",title:"Type",type:"status"},{key:"contact",title:"Contact",type:"custom"},{key:"status",title:"Status",type:"status"},{key:"createdAt",title:"Created",type:"text"}]}),ee=async()=>{F.value=!0;try{const e={page:K.value.currentPage,limit:K.value.limit,search:J.value.trim()||void 0,isGuest:void 0};"guest"===H.value?e.isGuest=!0:"normal"===H.value&&(e.isGuest=!1);const t=await v.getAllUsers(e);t.data.data&&(q.value=t.data.data.users.map(e=>({...e,createdAt:ae(e.createdAt)})),t.data.data.pagination&&(K.value={...t.data.data.pagination}))}catch(e){console.error("Error fetching users:",e),q.value=[],K.value={currentPage:1,totalPages:1,totalDocuments:0,hasNextPage:!1,hasPrevPage:!1,limit:10}}finally{F.value=!1}},te=e=>{K.value.currentPage=e,ee()},ae=e=>new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}),re=e=>e?e.length<=30?e:e.substring(0,27)+"...":"—",se=e=>{const t={admin:"bg-red-50 text-red-700 dark:bg-red-500/15 dark:text-red-500",user:"bg-blue-50 text-blue-700 dark:bg-blue-500/15 dark:text-blue-500"};return`rounded-full px-2 py-0.5 text-theme-xs font-medium ${t[e]||t.user}`},le=()=>{R.push("/users/edit/new")},ue=e=>{R.push(`/users/view/${e._id}`)},ne=e=>{R.push(`/users/edit/${e._id}`)},oe=async e=>{const t=e.isGuest?"this guest user":e.name;if(confirm(`Are you sure you want to delete ${t}?`))try{await v.deleteUser(e._id),await ee()}catch(a){console.error("Error deleting user:",a),alert("Failed to delete user")}};let ie;return r(J,()=>{clearTimeout(ie),ie=setTimeout(()=>{K.value.currentPage=1,ee()},500)}),r(H,()=>{K.value.currentPage=1,ee()}),s(()=>{ee()}),(e,t)=>(b(),l(h,null,{default:u(()=>[n(k,{pageTitle:V.value},null,8,["pageTitle"]),o("div",P,[n(f,{title:"Users Management"},{default:u(()=>[o("div",{class:"mb-4 flex justify-between items-center"},[t[4]||(t[4]=o("h3",{class:"text-lg font-semibold text-gray-800 dark:text-white"},"All Users",-1)),o("button",{onClick:le,class:"px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600 focus:outline-none focus:ring-2 focus:ring-brand-500 focus:ring-offset-2"}," Add User ")]),o("div",U,[o("div",A,[c(o("input",{"onUpdate:modelValue":t[0]||(t[0]=e=>J.value=e),type:"text",placeholder:"Search users by name, email, or phone...",class:"w-full px-4 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-brand-500"},null,512),[[p,J.value]]),t[5]||(t[5]=o("svg",{class:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))])]),o("div",G,[o("nav",j,[o("button",{onClick:t[1]||(t[1]=e=>H.value="all"),class:m(["py-4 px-1 border-b-2 font-medium text-sm transition-colors","all"===H.value?"border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"])},[t[6]||(t[6]=g(" All Users ",-1)),o("span",C,x(K.value.totalDocuments),1)],2),o("button",{onClick:t[2]||(t[2]=e=>H.value="normal"),class:m(["py-4 px-1 border-b-2 font-medium text-sm transition-colors","normal"===H.value?"border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"])},[t[7]||(t[7]=g(" Normal Users ",-1)),o("span",D,x("normal"===H.value?K.value.totalDocuments:"—"),1)],2),o("button",{onClick:t[3]||(t[3]=e=>H.value="guest"),class:m(["py-4 px-1 border-b-2 font-medium text-sm transition-colors","guest"===H.value?"border-brand-500 text-brand-600 dark:text-brand-400":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 dark:text-gray-400 dark:hover:text-gray-300"])},[t[8]||(t[8]=g(" Guest Users ",-1)),o("span",N,x("guest"===H.value?K.value.totalDocuments:"—"),1)],2)])]),F.value?(b(),i("div",T,[...t[9]||(t[9]=[o("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500"},null,-1)])])):(b(),l(_,{key:1,columns:Z.value,data:Y.value,showActions:!0,onView:ue,onEdit:ne,onDelete:oe},{"column-name":u(({item:e})=>{return[o("div",S,[o("div",$,[o("span",E,x((t=e.displayName,t?t.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"U")),1)]),o("div",null,[o("span",B,x(e.displayName),1),e.isGuest?(b(),i("span",W," Guest User ")):(b(),i("span",{key:0,class:"block text-gray-500 text-xs dark:text-gray-400",title:e.email},x(re(e.email)),9,I))])])];var t}),"column-contact":u(({item:e})=>[o("div",null,[o("span",z,x(e.phone||"—"),1),e.isGuest?(b(),i("span",M," Guest User ")):(b(),i("span",{key:0,class:"block text-gray-500 text-xs dark:text-gray-400",title:e.email},x(re(e.email)),9,L))])]),"column-role":u(({item:e})=>[o("span",{class:m(se(e.role))},x(e.role),3)]),"column-type":u(({item:e})=>[o("span",{class:m([e.isGuest?"bg-purple-50 text-purple-700 dark:bg-purple-500/15 dark:text-purple-400":"bg-blue-50 text-blue-700 dark:bg-blue-500/15 dark:text-blue-500","rounded-full px-2 py-0.5 text-xs font-medium"])},x(e.isGuest?"Guest":"Registered"),3)]),"column-status":u(({item:e})=>{return[o("span",{class:m((t=e.isActive,t?"bg-green-50 text-green-700 dark:bg-green-500/15 dark:text-green-500 rounded-full px-2 py-0.5 text-theme-xs font-medium":"bg-red-50 text-red-700 dark:bg-red-500/15 dark:text-red-500 rounded-full px-2 py-0.5 text-theme-xs font-medium"))},x(e.isActive?"Active":"Inactive"),3)];var t}),_:1},8,["columns","data"])),K.value.totalPages>1?(b(),l(w,{key:2,"current-page":K.value.currentPage,"total-pages":K.value.totalPages,"total-documents":K.value.totalDocuments,limit:K.value.limit,"has-next-page":K.value.hasNextPage,"has-prev-page":K.value.hasPrevPage,onPageChange:te},null,8,["current-page","total-pages","total-documents","limit","has-next-page","has-prev-page"])):d("",!0)]),_:1})])]),_:1}))}});export{R as default};
