import{d as t,r as e,m as a,o as r,j as s,k as l,q as n,b as o,l as i,c as u,f as d,t as c,n as m,B as p,e as g}from"./index-BChQAjBg.js";import{_ as x}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_ as y}from"./AdminLayout-BDbNDvIA.js";import{_ as v}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{D as f}from"./DataTable-D4TLCeTz.js";import{_ as k}from"./Pagination-D-pp1c0D.js";import{C as b}from"./CartsAPI-2yBGA81K.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ErrorIcon-CRM2J8oG.js";const h={class:"space-y-6"},P={class:"flex items-center justify-between"},_={key:0,class:"text-center py-8"},w={key:0},C={class:"font-medium text-gray-900 dark:text-white"},I=["title"],A={key:1,class:"text-gray-400"},j={class:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200"},D={class:"font-semibold text-gray-900 dark:text-white"},S={key:0,class:"text-sm text-green-600 dark:text-green-400"},F={key:1,class:"text-gray-400"},L=t({__name:"Carts",setup(t){const L=p(),T=e("Carts"),B=e([]),$=e(!1),K=e({currentPage:1,totalPages:1,totalDocuments:0,hasNextPage:!1,hasPrevPage:!1,limit:10}),M=e([{key:"user",title:"Customer",type:"text"},{key:"itemsCount",title:"Items",type:"text",widthClass:"w-24"},{key:"totalPrice",title:"Total",type:"text"},{key:"paymentStatus",title:"Payment Status",type:"text"},{key:"updatedAt",title:"Last Updated",type:"text"}]),N=a(()=>B.value.map(t=>{var e,a,r,s;return{...t,userInfo:t.userId?{name:t.userId.name||"—",email:t.userId.email||"—"}:null,itemsCount:(null==(e=t.cartItem)?void 0:e.length)||0,totalPrice:(null==(a=t.totalPrice)?void 0:a.toFixed(2))||"0.00",totalPriceAfterDiscount:(null==(r=t.totalPriceAfterDiscount)?void 0:r.toFixed(2))||null,paymentStatus:(null==(s=t.paymentSession)?void 0:s.status)||null,updatedAt:t.updatedAt?new Date(t.updatedAt).toLocaleDateString():"—"}})),W=t=>{switch(t){case"completed":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"pending":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-200";case"failed":return"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},q=async()=>{$.value=!0;try{const t={page:K.value.currentPage,limit:K.value.limit},{data:e}=await b.getAllCarts(t);(null==e?void 0:e.data)&&(B.value=e.data.carts||[],e.data.pagination&&(K.value={...e.data.pagination}))}catch(t){console.error("Failed to fetch carts:",t),B.value=[]}finally{$.value=!1}},E=t=>{K.value.currentPage=t,q()},H=t=>{L.push(`/carts/view/${t._id}`)},U=t=>{L.push(`/carts/edit/${t._id}`)},z=async t=>{try{await b.deleteCart(t._id),await q()}catch(e){console.error("Failed to delete cart:",e)}};return r(q),(t,e)=>(g(),s(y,null,{default:l(()=>[n(x,{pageTitle:T.value},null,8,["pageTitle"]),o("div",h,[o("div",P,[e[2]||(e[2]=o("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Carts Management",-1)),o("button",{onClick:e[0]||(e[0]=e=>t.$router.push("/carts/add")),class:"px-6 py-2.5 bg-brand-500 text-white rounded-lg hover:bg-brand-600 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-colors duration-200 font-medium flex items-center gap-2"},[...e[1]||(e[1]=[o("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[o("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),i(" Create Cart ",-1)])])]),n(v,{title:"All Carts"},{default:l(()=>[$.value?(g(),u("div",_,[...e[3]||(e[3]=[o("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500 mx-auto"},null,-1),o("p",{class:"mt-2 text-gray-500"},"Loading carts...",-1)])])):(g(),s(f,{key:1,columns:M.value,data:N.value,"show-actions":!0,"on-view":H,"on-edit":U,"on-delete":z},{"column-user":l(({item:t})=>[t.userInfo?(g(),u("div",w,[o("p",C,c(t.userInfo.name),1),o("p",{class:"text-sm text-gray-500 dark:text-gray-400",title:t.userInfo.email},c(t.userInfo.email.length>20?t.userInfo.email.substring(0,20)+"...":t.userInfo.email),9,I)])):(g(),u("span",A,"—"))]),"column-itemsCount":l(({item:t})=>[o("span",j,c(t.itemsCount)+" items ",1)]),"column-totalPrice":l(({item:t})=>[o("div",null,[o("p",D,c(t.totalPrice)+" KWD",1),t.totalPriceAfterDiscount?(g(),u("p",S," After discount: "+c(t.totalPriceAfterDiscount)+" KWD ",1)):d("",!0)])]),"column-paymentStatus":l(({item:t})=>[t.paymentStatus?(g(),u("span",{key:0,class:m(["inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",W(t.paymentStatus)])},c(t.paymentStatus),3)):(g(),u("span",F,"—"))]),_:1},8,["columns","data"])),K.value.totalPages>1?(g(),s(k,{key:2,"current-page":K.value.currentPage,"total-pages":K.value.totalPages,"total-documents":K.value.totalDocuments,limit:K.value.limit,"has-next-page":K.value.hasNextPage,"has-prev-page":K.value.hasPrevPage,onPageChange:E},null,8,["current-page","total-pages","total-documents","limit","has-next-page","has-prev-page"])):d("",!0)]),_:1})])]),_:1}))}});export{L as default};
