import{d as e,r as a,m as t,o as r,j as l,k as d,a as u,q as s,b as i,B as o,e as n}from"./index-BChQAjBg.js";import{_ as c}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_ as p}from"./AdminLayout-BDbNDvIA.js";import{_ as m}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{_ as v}from"./Form.vue_vue_type_script_setup_true_lang-Dj0hsM9h.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const y={class:"space-y-6"},b=e({__name:"AddOrder",setup(e){const b=o(),f=a("Add Order"),_=a(!1),h=a([]),I=a([]),g=a(null),k=a({userId:"",cartItems:[],paymentMethod:"cash",status:"pending",isPaid:!1,isDelivered:!1,totalOrderPrice:0}),P=t(()=>[{key:"userId",type:"select",label:"Customer",required:!0,placeholder:"Select a customer",options:Array.isArray(h.value)?h.value.map(e=>({label:`${e.name} (${e.email})`,value:e._id})):[]},{key:"cartItems",type:"array",label:"Order Items",required:!0,minItems:1,addButtonText:"+ Add Item",itemLabel:"Item",emptyMessage:'No items added. Click "Add Item" to start.',fields:[{key:"productId",type:"select",label:"Product",required:!0,placeholder:"Select a product",options:Array.isArray(I.value)?I.value.map(e=>{var a;return{label:(null==(a=e.title)?void 0:a.en)||e.name||"Unknown",value:e._id}}):[]},{key:"quantity",type:"number",label:"Quantity",required:!0,min:1,placeholder:"1"},{key:"price",type:"number",label:"Price (KWD)",required:!0,min:0,step:.01,placeholder:"0.00",hint:"Auto-filled from product, but you can edit it"}]},{key:"paymentMethod",type:"select",label:"Payment Method",required:!0,options:[{label:"Cash",value:"cash"},{label:"Card",value:"card"},{label:"Knet",value:"knet"},{label:"Mastercard",value:"mastercard"}]},{key:"status",type:"select",label:"Order Status",required:!0,options:[{label:"Pending",value:"pending"},{label:"Under Preparation",value:"under_preparation"},{label:"Under Delivery",value:"under_delivery"},{label:"Delivered",value:"delivered"},{label:"Cancelled",value:"cancelled"},{label:"Refunded",value:"refunded"}]},{key:"isPaid",type:"switch",label:"Payment Completed"},{key:"isDelivered",type:"switch",label:"Delivered"},{key:"totalOrderPrice",type:"number",label:"Total Order Price (KWD)",required:!0,min:0,step:.01,placeholder:"0.00",hint:"Auto-calculated from items, but you can edit it"}]),A=(e,a,t)=>{var r,l,d,u;if(e.includes("cartItems")&&e.includes("productId")){const t=e.match(/cartItems\[(\d+)\]\.productId/);if(t){const e=parseInt(t[1]),s=(u=a,I.value.find(e=>e._id===u));if(s&&(null==(d=null==(l=null==(r=g.value)?void 0:r.formData)?void 0:l.cartItems)?void 0:d[e])){const a=s.price||s.priceBeforeOffer||0;g.value.formData.cartItems[e].price=a}}}(e.includes("cartItems")||"cartItems"===e)&&setTimeout(()=>{var e,a;if(null==(e=g.value)?void 0:e.formData){const e=(a=g.value.formData.cartItems||[],Array.isArray(a)&&0!==a.length?a.reduce((e,a)=>e+(Number(a.quantity)||0)*(Number(a.price)||0),0):0);g.value.formData.totalOrderPrice=parseFloat(e.toFixed(2))}},100)},C=async()=>{var e;try{const{data:a}=await u.get("/users");h.value=(null==(e=null==a?void 0:a.data)?void 0:e.users)||(null==a?void 0:a.users)||(null==a?void 0:a.data)||[]}catch(a){console.error("Failed to fetch users:",a)}},D=async()=>{var e;try{const{data:a}=await u.get("/products");I.value=(null==(e=null==a?void 0:a.data)?void 0:e.products)||(null==a?void 0:a.products)||(null==a?void 0:a.data)||[]}catch(a){console.error("Failed to fetch products:",a)}},q=async e=>{_.value=!0;try{await u.post("/orders",e),b.push("/orders")}catch(a){console.error("Failed to create order:",a)}finally{_.value=!1}},O=()=>{b.push("/orders")};return r(async()=>{await Promise.all([C(),D()])}),(e,a)=>(n(),l(p,null,{default:d(()=>[s(c,{pageTitle:f.value},null,8,["pageTitle"]),i("div",y,[s(m,{title:"Create New Order"},{default:d(()=>[s(v,{ref_key:"formRef",ref:g,fields:P.value,"initial-data":k.value,"show-submit-button":!0,"submit-button-text":"Create Order","show-reset-button":!0,"reset-button-text":"Cancel",loading:_.value,onSubmit:q,onReset:O,onChange:A},null,8,["fields","initial-data","loading"])]),_:1})])]),_:1}))}});export{b as default};
