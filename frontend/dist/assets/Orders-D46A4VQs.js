import{a as e,d as t,r as a,H as r,z as l,o as s,j as d,k as o,q as n,b as u,l as i,w as c,A as g,E as p,t as v,f as m,c as y,i as x,F as b,n as h,B as k,e as f}from"./index-BChQAjBg.js";import{_ as w}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_}from"./AdminLayout-BDbNDvIA.js";import{_ as C}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{D as P}from"./DataTable-D4TLCeTz.js";import{_ as I}from"./Pagination-D-pp1c0D.js";import{g as j}from"./helpers-BbRepCn0.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";import"./ErrorIcon-CRM2J8oG.js";const D=(t={})=>e.get("/orders/all",{params:t}),U=(t,a)=>e.patch(`/orders/update-status/${t}`,{status:a}),A=t=>e.delete(`/orders/${t}`),S={class:"space-y-6"},O={class:"flex items-center justify-between"},T={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},$={class:"relative"},B={class:"flex items-center gap-2 mt-4"},E={class:"text-sm text-gray-500 dark:text-gray-400"},V=["title"],z={class:"flex items-center gap-2"},F=["onUpdate:modelValue","onChange"],H=["value"],M={class:"space-y-1"},q={class:"text-gray-900 dark:text-white font-medium text-sm"},G={class:"text-gray-500 dark:text-gray-400 text-xs"},L={key:0,class:"text-gray-500 dark:text-gray-400 text-xs"},N={class:"space-y-2"},R={class:"flex items-center gap-2"},K={class:"bg-blue-100 text-blue-800 dark:bg-blue-500/15 dark:text-blue-400 text-xs font-medium px-2 py-1 rounded-full"},W={class:"space-y-1 max-w-xs"},J={class:"w-6 h-6 bg-gray-100 dark:bg-gray-800 rounded overflow-hidden flex-shrink-0"},Q=["src","alt"],X={key:1,class:"w-full h-full flex items-center justify-center text-gray-400"},Y={class:"flex-1 min-w-0"},Z={class:"text-gray-700 dark:text-gray-300 truncate"},ee={class:"text-gray-500 dark:text-gray-400"},te={key:0,class:"text-xs text-gray-500 dark:text-gray-400"},ae=["title"],re=t({__name:"Orders",setup(e){const t=k(),j=a("Orders"),re=r({search:"",status:""}),le=[{label:"Pending",value:"pending"},{label:"Under Preparation",value:"under_preparation"},{label:"Under Delivery",value:"under_delivery"},{label:"Delivered",value:"delivered"},{label:"Cancelled",value:"cancelled"},{label:"Refunded",value:"refunded"}],se=a([{key:"orderId",title:"Order ID",type:"text",widthClass:"w-48"},{key:"user",title:"Customer",type:"text",widthClass:"w-48"},{key:"itemsCount",title:"Products",type:"text",widthClass:"w-80"},{key:"totalOrderPrice",title:"Total",type:"text",widthClass:"w-28"},{key:"status",title:"Status",type:"status",badgeType:"info",widthClass:"w-64"},{key:"createdAt",title:"Created",type:"text",widthClass:"w-40"}]),de=a([]),oe=a(!1),ne=a({currentPage:1,totalPages:1,totalDocuments:0,hasNextPage:!1,hasPrevPage:!1,limit:10}),ue=e=>{switch(e){case"pending":return"bg-yellow-50 text-yellow-700 dark:bg-yellow-500/15 dark:text-yellow-400";case"under_preparation":return"bg-cyan-50 text-cyan-700 dark:bg-cyan-500/15 dark:text-cyan-500";case"under_delivery":return"bg-blue-50 text-blue-700 dark:bg-blue-500/15 dark:text-blue-500";case"delivered":return"bg-green-50 text-green-700 dark:bg-green-500/15 dark:text-green-500";case"cancelled":return"bg-red-50 text-red-700 dark:bg-red-500/15 dark:text-red-500";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},ie=async()=>{oe.value=!0;try{const e={page:ne.value.currentPage,limit:ne.value.limit,search:re.search.trim()||void 0,status:re.status||void 0},{data:t}=await D(e);if(null==t?void 0:t.data){const e=t.data.orders||[];de.value=e.map(e=>({...e,id:e.orderId||e._id,user:e.userId?{name:e.userId.name,email:e.userId.email,phone:e.userId.phone,isGuest:e.userId.isGuest}:null,itemsCount:Array.isArray(e.cartItems)?e.cartItems.reduce((e,t)=>e+(t.quantity||0),0):0,createdAt:e.createdAt?new Date(e.createdAt).toLocaleString():""})),t.data.pagination&&(ne.value={...t.data.pagination})}}catch(e){console.error("Error fetching orders:",e),de.value=[]}finally{oe.value=!1}},ce=e=>{ne.value.currentPage=e,ie()};let ge;l(()=>re.search,()=>{clearTimeout(ge),ge=setTimeout(()=>{ne.value.currentPage=1,ie()},500)}),l(()=>re.status,()=>{ne.value.currentPage=1,ie()});const pe=()=>{re.search="",re.status="",ne.value.currentPage=1,ie()},ve=e=>{var t,a;return e?"object"==typeof e.title?(null==(t=e.title)?void 0:t.en)||(null==(a=e.title)?void 0:a.ar)||"Unknown Product":e.title||e.name||"Unknown Product":"Unknown Product"},me=e=>{e.target.src="/placeholder-product.png"},ye=e=>{t.push(`/orders/view/${e._id}`)},xe=e=>{t.push(`/orders/edit/${e._id}`)},be=async e=>{try{await A(e._id),await ie()}catch(t){console.error("Failed to delete order:",t)}};return s(ie),(e,t)=>(f(),d(_,null,{default:o(()=>[n(w,{pageTitle:j.value},null,8,["pageTitle"]),u("div",S,[u("div",O,[t[4]||(t[4]=u("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white"},"Orders Management",-1)),u("button",{onClick:t[0]||(t[0]=t=>e.$router.push("/orders/add")),class:"px-6 py-2.5 bg-brand-500 text-white rounded-lg hover:bg-brand-600 focus:outline-none focus:ring-2 focus:ring-brand-500 transition-colors duration-200 font-medium flex items-center gap-2"},[...t[3]||(t[3]=[u("svg",{class:"w-5 h-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M12 4v16m8-8H4"})],-1),i(" Create Order ",-1)])])]),n(C,{title:"Search & Filters"},{default:o(()=>[u("div",T,[u("div",$,[c(u("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>re.search=e),type:"text",placeholder:"Search by Order ID, Customer, Email, Product name, or Status...",class:"w-full px-4 py-2 pl-10 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-brand-500"},null,512),[[g,re.search]]),t[5]||(t[5]=u("svg",{class:"absolute left-3 top-2.5 w-5 h-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[u("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})],-1))]),u("div",null,[c(u("select",{"onUpdate:modelValue":t[2]||(t[2]=e=>re.status=e),class:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-brand-500"},[...t[6]||(t[6]=[u("option",{value:""},"All Statuses",-1),u("option",{value:"pending"},"Pending",-1),u("option",{value:"under_preparation"},"Under Preparation",-1),u("option",{value:"under_delivery"},"Under Delivery",-1),u("option",{value:"delivered"},"Delivered",-1),u("option",{value:"cancelled"},"Cancelled",-1),u("option",{value:"refunded"},"Refunded",-1)])],512),[[p,re.status]])])]),u("div",B,[u("button",{onClick:pe,class:"px-4 py-2 text-gray-600 dark:text-gray-400 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"}," Clear Filters "),u("div",E," Showing "+v(de.value.length)+" of "+v(ne.value.totalDocuments)+" orders ",1)])]),_:1}),n(C,{title:`Orders (${ne.value.totalDocuments})`},{default:o(()=>[n(P,{columns:se.value,data:de.value,"show-actions":!0,"on-view":ye,"on-edit":xe,"on-delete":be},{"column-id":o(({item:e})=>[u("code",{class:"text-xs bg-gray-100 dark:bg-gray-800 rounded px-2 py-0.5 inline-block",title:e.orderId},v(e.orderId?e.orderId.substring(0,4)+"...":"—"),9,V)]),'"column-status"':o(({item:e})=>{return[u("div",z,[u("span",{class:h(["rounded-full px-2 py-0.5 text-theme-xs font-medium",ue(e.status)])},v((t=e.status,t?t.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"")),3),c(u("select",{class:"ml-2 border border-gray-300 rounded-md text-xs px-2 py-1 dark:bg-gray-800 dark:border-gray-700","onUpdate:modelValue":t=>e.status=t,onChange:t=>(async e=>{const t=e._id,a=e.status;try{await U(t,a)}catch(r){await ie()}})(e)},[(f(),y(b,null,x(le,e=>u("option",{key:e.value,value:e.value},v(e.label),9,H)),64))],40,F),[[p,e.status]])])];var t}),"column-user":o(({item:e})=>{var t,a,r;return[u("div",M,[u("p",q,v((null==(t=e.user)?void 0:t.name)||"—"),1),u("p",G,v((null==(a=e.user)?void 0:a.email)||"—"),1),(null==(r=e.user)?void 0:r.phone)?(f(),y("p",L,v(e.user.phone),1)):m("",!0)])]}),'"column-itemsCount"':o(({item:e})=>{var a,r;return[u("div",N,[u("div",R,[u("span",K,v(e.itemsCount)+" "+v(1===e.itemsCount?"item":"items"),1)]),u("div",W,[(f(!0),y(b,null,x(null==(a=e.cartItems)?void 0:a.slice(0,2),(e,a)=>{var r,l;return f(),y("div",{key:a,class:"flex items-center gap-2 text-xs"},[u("div",J,[(null==(r=e.productId)?void 0:r.imgCover)?(f(),y("img",{key:0,src:(l=e.productId.imgCover,l?`https://luxankw.com/api/v1/images/image/${l}`:"/placeholder-product.png"),alt:ve(e.productId),class:"w-full h-full object-cover",onError:me},null,40,Q)):(f(),y("div",X,[...t[7]||(t[7]=[u("svg",{class:"w-3 h-3",fill:"currentColor",viewBox:"0 0 20 20"},[u("path",{"fill-rule":"evenodd",d:"M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z","clip-rule":"evenodd"})],-1)])]))]),u("div",Y,[u("p",Z,v(ve(e.productId)),1),u("p",ee,v(e.quantity)+"x "+v(e.price)+" KWD ",1)])])}),128)),(null==(r=e.cartItems)?void 0:r.length)>2?(f(),y("div",te," +"+v(e.cartItems.length-2)+" more items ",1)):m("",!0)])])]}),'"column-id"':o(({item:e})=>[u("code",{class:"text-xs bg-gray-100 dark:bg-gray-800 rounded px-1 py-0.5 inline-block max-w-16 truncate",title:e.orderId},v(e.orderId&&e.orderId.toString().length>4?e.orderId.toString().substring(0,4)+"...":e.orderId),9,ae)]),_:1},8,["columns","data"]),ne.value.totalPages>1?(f(),d(I,{key:0,"current-page":ne.value.currentPage,"total-pages":ne.value.totalPages,"total-documents":ne.value.totalDocuments,limit:ne.value.limit,"has-next-page":ne.value.hasNextPage,"has-prev-page":ne.value.hasPrevPage,onPageChange:ce},null,8,["current-page","total-pages","total-documents","limit","has-next-page","has-prev-page"])):m("",!0)]),_:1},8,["title"])])]),_:1}))}});export{re as default};
