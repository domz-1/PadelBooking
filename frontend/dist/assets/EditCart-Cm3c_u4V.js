import{d as t,C as a,r as e,m as r,o as l,j as u,k as s,a as i,q as o,c as d,b as n,B as c,e as p}from"./index-BChQAjBg.js";import{_ as m}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_ as v}from"./AdminLayout-BDbNDvIA.js";import{_ as y}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{_}from"./Form.vue_vue_type_script_setup_true_lang-Dj0hsM9h.js";import{C as b}from"./CartsAPI-2yBGA81K.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const f={key:0,class:"flex items-center justify-center py-12"},C={key:1,class:"space-y-6"},I=t({__name:"EditCart",setup(t){const I=a(),h=c(),g=I.params.id,j=e("Edit Cart"),w=e(!1),k=e(!1),q=e({}),x=e([]),A=r(()=>[{key:"cartItem",type:"array",label:"Cart Items",required:!0,minItems:1,addButtonText:"+ Add Item",itemLabel:"Item",fields:[{key:"productId",type:"select",label:"Product",required:!0,placeholder:"Select a product",options:Array.isArray(x.value)?x.value.map(t=>{var a;return{label:(null==(a=t.title)?void 0:a.en)||t.name||"Unknown",value:t._id}}):[]},{key:"quantity",type:"number",label:"Quantity",required:!0,min:1}]}]),B=async()=>{var t;w.value=!0;try{const{data:a}=await b.getCartById(g),e=null==a?void 0:a.data;e&&(q.value={cartItem:(null==(t=e.cartItem)?void 0:t.map(t=>{var a;return{productId:(null==(a=t.productId)?void 0:a._id)||t.productId,quantity:t.quantity}}))||[]})}catch(a){console.error("Failed to fetch cart:",a)}finally{w.value=!1}},F=async()=>{var t;try{const{data:a}=await i.get("/products");x.value=(null==(t=null==a?void 0:a.data)?void 0:t.products)||(null==a?void 0:a.products)||(null==a?void 0:a.data)||[]}catch(a){console.error("Failed to fetch products:",a)}},P=async t=>{k.value=!0;try{await b.updateCart(g,t),h.push("/carts")}catch(a){console.error("Failed to update cart:",a)}finally{k.value=!1}},E=()=>{h.push("/carts")};return l(async()=>{await Promise.all([F(),B()])}),(t,a)=>(p(),u(v,null,{default:s(()=>[o(m,{pageTitle:j.value},null,8,["pageTitle"]),w.value?(p(),d("div",f,[...a[0]||(a[0]=[n("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-brand-500"},null,-1)])])):(p(),d("div",C,[o(y,{title:"Edit Cart"},{default:s(()=>[o(_,{fields:A.value,"initial-data":q.value,"show-submit-button":!0,"submit-button-text":"Update Cart","show-reset-button":!0,"reset-button-text":"Cancel",loading:k.value,onSubmit:P,onReset:E},null,8,["fields","initial-data","loading"])]),_:1})]))]),_:1}))}});export{I as default};
