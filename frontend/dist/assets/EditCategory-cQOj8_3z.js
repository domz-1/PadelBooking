import{r as e,C as a,m as t,o as l,j as o,k as r,q as n,b as s,c as i,f as g,B as c,e as u}from"./index-BChQAjBg.js";import{_ as m}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_ as d}from"./AdminLayout-BDbNDvIA.js";import{_ as y}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{_ as v}from"./Form.vue_vue_type_script_setup_true_lang-Dj0hsM9h.js";import{L as p}from"./LazyImage-BMawgtWq.js";import{C as h}from"./CategoriesAPI-CbxhYl7H.js";import{I as f}from"./ImagesAPI-Lj7hDOQz.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const C={class:"space-y-5 sm:space-y-6"},_={key:0,class:"mb-6"},b={class:"flex items-center space-x-4"},I=["disabled"],E={__name:"EditCategory",setup(E){const x=a(),w=c(),A=e(!1),S=e(null),j=e(null);console.log("[EditCategory] route.params.id:",x.params.id);const k=t(()=>"new"!==x.params.id),D=t(()=>k.value?"Edit Category":"Create Category");console.log("[EditCategory] isEdit:",k.value),console.log("[EditCategory] pageTitle:",D.value);const L=[{key:"nameEn",type:"text",label:"Name (English)",placeholder:"Enter category name in English",required:!0,validation:{minLength:2,maxLength:50}},{key:"nameAr",type:"text",label:"Name (Arabic)",placeholder:"Enter category name in Arabic",required:!0,validation:{minLength:2,maxLength:50}},{key:"Image",type:"file",label:"Category Image",accept:"image/*",required:!k.value}],B=e({nameEn:"",nameAr:"",Image:null}),P=async()=>{if(j.value&&j.value._id){if(confirm("Are you sure you want to delete this image?")){A.value=!0;try{console.log("[deleteCurrentImage] deleting image with id:",j.value._id),await f.deleteImageById(j.value._id),j.value=null;const e=localStorage.getItem("token"),a={en:S.value.name.en,ar:S.value.name.ar};await h.updateCategory(x.params.id,a,e),console.log("[deleteCurrentImage] image deleted successfully"),alert("Image deleted successfully")}catch(e){console.error("[deleteCurrentImage] Error deleting image:",e),alert("Error deleting image. Please try again.")}finally{A.value=!1}}}else console.log("[deleteCurrentImage] No image to delete")},T=async e=>{console.log("[handleSubmit] called with formData:",e),A.value=!0;try{const a=localStorage.getItem("token");console.log("[handleSubmit] token from localStorage:",a);const t={en:e.nameEn,ar:e.nameAr};if(console.log("[handleSubmit] nameData:",t),k.value){console.log("[handleSubmit] updating category with id:",x.params.id);const l=e.Image instanceof File?e.Image:void 0;await h.updateCategory(x.params.id,t,a,l),console.log("[handleSubmit] updateCategory success")}else console.log("[handleSubmit] creating new category"),await h.createCategory(t,e.Image,a),console.log("[handleSubmit] createCategory success");w.push("/categories")}catch(a){console.error("[handleSubmit] Error saving category:",a),alert("Error saving category. Please try again.")}finally{A.value=!1,console.log("[handleSubmit] loading set to false")}},q=()=>{console.log("[handleReset] called"),k.value&&S.value?(B.value={nameEn:S.value.name.en,nameAr:S.value.name.ar,Image:null},console.log("[handleReset] reset to categoryData:",B.value)):(B.value={nameEn:"",nameAr:"",Image:null},console.log("[handleReset] reset to empty form:",B.value))};return l(()=>{console.log("[onMounted] component mounted, calling fetchCategory..."),(async()=>{if(console.log("[fetchCategory] called, isEdit:",k.value),k.value)try{console.log("[fetchCategory] fetching all categories...");const e=await h.getAllCategories();console.log("[fetchCategory] response:",e);const a=e.data.data.categories;console.log("[fetchCategory] categories array:",a);const t=a.find(e=>e._id===x.params.id);console.log("[fetchCategory] found category:",t),t?(S.value=t,t.Image&&t.Image.base64&&(j.value=t.Image,console.log("[fetchCategory] currentImage set:",j.value)),B.value={nameEn:t.name.en,nameAr:t.name.ar,Image:null},console.log("[fetchCategory] initialFormData set:",B.value)):console.warn("[fetchCategory] no category matched the id:",x.params.id)}catch(e){console.error("[fetchCategory] Error fetching category:",e)}})()}),(e,a)=>(u(),o(d,null,{default:r(()=>[n(m,{pageTitle:D.value},null,8,["pageTitle"]),s("div",C,[n(y,{title:D.value},{default:r(()=>{var e,t;return[k.value&&j.value?(u(),i("div",_,[a[0]||(a[0]=s("h3",{class:"text-lg font-medium text-gray-900 mb-3"},"Current Image",-1)),s("div",b,[n(p,{"image-id":"string"==typeof j.value?j.value:j.value._id,alt:(null==(t=null==(e=S.value)?void 0:e.name)?void 0:t.en)||"Category Image",width:"128px",height:"128px","image-class":"w-32 h-32 object-cover rounded-lg border border-gray-200",placeholder:"/placeholder-category.png"},null,8,["image-id","alt"]),s("button",{onClick:P,disabled:A.value,class:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed"}," Delete Image ",8,I)])])):g("",!0),n(v,{fields:L,initialData:B.value,submitButtonText:k.value?"Update Category":"Create Category",loading:A.value,onSubmit:T,onReset:q},null,8,["initialData","submitButtonText","loading"])]}),_:1},8,["title"])])]),_:1}))}};export{E as default};
