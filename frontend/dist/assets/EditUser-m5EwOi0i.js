import{u as e,r as a,C as l,m as r,z as o,o as s,j as t,k as i,q as d,b as u,c as n,t as p,B as m,e as v}from"./index-BChQAjBg.js";import{U as c}from"./UsersAPI-Z4wDRJSF.js";import{k as y}from"./kuwaitAreas-DKjAD5u7.js";import{_ as b}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_ as f}from"./AdminLayout-BDbNDvIA.js";import{_ as g}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{_ as k}from"./Form.vue_vue_type_script_setup_true_lang-Dj0hsM9h.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const h={class:"space-y-5 sm:space-y-6"},A={key:0,class:"flex justify-center items-center py-8"},w={key:1,class:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg"},_={__name:"EditUser",setup(_){const E=l(),x=m(),N=e(),q=a(!1),I=a(!1),U=a(""),B=a(E.params.id),L=a(null),R=a({name:"",email:"",phone:"",role:"user",isActive:!0,verified:!1,blocked:!1,password:"",addresses:[]}),j=r(()=>"new"!==B.value),C=r(()=>j.value?"Edit User":"Add User"),F=r(()=>j.value?"Edit User Information":"Add New User"),P=r(()=>[{key:"name",type:"text",label:"Full Name",placeholder:"Enter user's full name",required:!0,validation:{minLength:2,maxLength:50}},{key:"email",type:"email",label:"Email Address",placeholder:"Enter user's email address",required:!0,validation:{pattern:/^[^\s@]+@[^\s@]+\.[^\s@]+$/}},{key:"phone",type:"tel",label:"Phone Number",placeholder:"Enter user's phone number",required:!0,validation:{pattern:/^[\+]?[1-9][\d]{0,15}$/}},{key:"role",type:"select",label:"User Role",required:!0,options:[{label:"User",value:"user"},{label:"Admin",value:"admin"}]},{key:"password",type:"password",label:"Password",placeholder:"Enter user's password",required:!j.value,hidden:j.value,validation:j.value?{}:{minLength:6,maxLength:50}},{key:"isActive",type:"switch",label:"Active Status"},{key:"verified",type:"switch",label:"Email Verified"},{key:"blocked",type:"switch",label:"Blocked"},{type:"array",key:"addresses",label:"Addresses",description:"Manage user's addresses",allowAdd:!0,allowRemove:!0,minItems:0,maxItems:3,addButtonText:"+ Add Address",removeButtonText:"Remove Address",itemLabel:"Address",emptyMessage:"No addresses added. Click '+ Add Address' to add one.",groupClass:"grid grid-cols-1 gap-4",defaultItemData:{type:"home",area:"",paciNumber:"",streetName:"",additionalInfo:"",googleLocationLink:"",blockNumber:"",buildingNumber:"",floor:"",apartmentNo:"",officeNo:""},fields:[{key:"type",type:"select",label:"Address Type *",required:!0,options:[{label:"Home",value:"home"},{label:"Building",value:"building"},{label:"Office",value:"office"}]},{key:"area",type:"select",label:"Area *",placeholder:"Select area",required:!0,options:y.map(e=>({label:e.nameEn,value:e.id}))},{key:"paciNumber",type:"text",label:"PACI Number",placeholder:"Enter PACI number"},{key:"streetName",type:"text",label:"Street Name * (Required for all types)",placeholder:"Enter street name",required:!0},{key:"blockNumber",type:"text",label:"Block Number * (Required for all types)",placeholder:"Enter block number",required:!0},{key:"buildingNumber",type:"text",label:"Building Number (Optional)",placeholder:"Enter building number (optional)",required:!1},{key:"floor",type:"text",label:"Floor (Required for Building type)",placeholder:"Enter floor number",required:!1,conditional:{field:"type",value:"building"}},{key:"apartmentNo",type:"text",label:"Apartment No. (Required for Building type)",placeholder:"Enter apartment number",required:!1,conditional:{field:"type",value:"building"}},{key:"officeNo",type:"text",label:"Office No. (Required for Office type)",placeholder:"Enter office number",required:!1,conditional:{field:"type",value:"office"}},{key:"additionalInfo",type:"textarea",label:"Additional Info",placeholder:"Enter additional information (optional)",required:!1,rows:3},{key:"googleLocationLink",type:"url",label:"Google Location Link (Optional)",placeholder:"Enter Google Maps link",required:!1}]}]),T=async()=>{if(j.value){q.value=!0,U.value="";try{const e=await c.getUser(B.value);L.value=e.data.data.user,console.log("Loaded user data:",L.value),R.value={name:L.value.name||"",email:L.value.email||"",phone:L.value.phone||"",role:L.value.role||"user",isActive:L.value.isActive||!1,verified:L.value.verified||!1,blocked:L.value.blocked||!1,password:"",addresses:L.value.addresses||[]}}catch(e){U.value="Failed to load user data. Please try again.",console.error("Error loading user:",e)}finally{q.value=!1}}},S=async e=>{var a,l;console.log("Form submitted with values:",e),console.log("isEditMode:",j.value),console.log("userId:",B.value),I.value=!0,U.value="";try{const a={name:e.name,email:e.email,phone:e.phone,role:e.role,isActive:e.isActive,verified:e.verified,blocked:e.blocked,addresses:e.addresses||[]};!j.value&&e.password&&(a.password=e.password),console.log("Submitting data:",a),j.value?await c.updateUser(B.value,a,N.token):await c.createUser(a),console.log("User saved successfully, navigating to users list"),x.push("/users")}catch(r){U.value=(null==(l=null==(a=r.response)?void 0:a.data)?void 0:l.message)||"Failed to save user. Please try again.",console.error("Error saving user:",r)}finally{I.value=!1}},M=()=>{console.log("Form reset triggered"),j.value&&L.value?R.value={name:L.value.name||"",email:L.value.email||"",phone:L.value.phone||"",role:L.value.role||"user",isActive:L.value.isActive||!1,verified:L.value.verified||!1,blocked:L.value.blocked||!1,password:"",addresses:L.value.addresses||[]}:R.value={name:"",email:"",phone:"",role:"user",isActive:!0,verified:!1,blocked:!1,password:"",addresses:[]}},O=(e,a)=>{console.log("Array item added:",e,a)},D=(e,a)=>{console.log("Array item removed:",e,a)},G=(e,a,l)=>{console.log("Field changed:",e,a)};return o(()=>E.params.id,e=>{console.log("Route changed, new userId:",e),B.value=e,j.value?T():R.value={name:"",email:"",phone:"",role:"user",isActive:!0,verified:!1,blocked:!1,password:"",addresses:[]}}),s(()=>{console.log("Component mounted, isEditMode:",j.value),j.value&&T()}),(e,a)=>(v(),t(f,null,{default:i(()=>[d(b,{pageTitle:C.value},null,8,["pageTitle"]),u("div",h,[d(g,{title:F.value},{default:i(()=>[q.value?(v(),n("div",A,[...a[0]||(a[0]=[u("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500"},null,-1)])])):U.value?(v(),n("div",w,p(U.value),1)):(v(),t(k,{key:2,fields:P.value,initialData:R.value,loading:I.value,submitButtonText:"Save User",showResetButton:!0,resetButtonText:"Reset Form",onSubmit:S,onReset:M,onArrayItemAdd:O,onArrayItemRemove:D,onChange:G},null,8,["fields","initialData","loading"]))]),_:1},8,["title"])])]),_:1}))}};export{_ as default};
