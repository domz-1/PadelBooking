import{m as e,C as t,r as a,o as r,j as i,k as o,q as l,b as s,c as n,f as d,t as u,F as c,i as g,D as v,B as p,e as m}from"./index-BChQAjBg.js";import{_ as y}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_ as b}from"./AdminLayout-BDbNDvIA.js";import{_ as h}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{_ as f}from"./Form.vue_vue_type_script_setup_true_lang-Dj0hsM9h.js";import{L as x}from"./LazyImage-BMawgtWq.js";import{P as w}from"./ProductsAPI-MABK5z0-.js";import{C}from"./CategoriesAPI-CbxhYl7H.js";import{S as k}from"./SubcategoriesAPI-C_blSPdt.js";import{I as A}from"./ImagesAPI-Lj7hDOQz.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const E={class:"space-y-5 sm:space-y-6"},I={key:0,class:"text-center py-8"},_={key:1,class:"text-center py-8"},q={class:"text-red-500"},B={key:2,class:"mb-6"},P={key:0,class:"mb-4"},L={class:"relative inline-block"},S=["disabled"],j={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},N={key:0,class:"mt-2"},T={class:"text-sm text-gray-600"},F={class:"text-xs text-gray-500"},M={key:1,class:"mb-4"},z={class:"text-sm font-medium text-gray-600 mb-2"},O={class:"grid grid-cols-2 md:grid-cols-4 gap-4"},R=["onClick","disabled"],D={key:0,xmlns:"http://www.w3.org/2000/svg",class:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor"},U={key:1,class:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24"},V={key:0,class:"text-xs text-gray-500 mt-1 truncate"},H={key:3,class:"mb-4 p-4 bg-red-50 border border-red-200 rounded-lg"},Q={class:"flex"},K={class:"ml-3"},G={class:"mt-2 text-sm text-red-700"},J={__name:"EditProduct",setup(J){const W=t(),X=p(),Y=e(()=>W.params.id),Z=e(()=>Y.value&&"new"!==Y.value),$=e(()=>Z.value?"Edit Product":"Add New Product"),ee=a(!1),te=a(0),ae=a(!1),re=a(""),ie=a(null),oe=a({title:{en:"",ar:""},description:{en:"",ar:""},price:0,priceBeforeOffer:0,quantity:0,category:"",subcategory:"",productCode:"",tagsEn:[],tagsAr:[],notesEn:[],notesAr:[],isActive:!0,isFeatured:!1,isInStock:!0,priority:!1,imgCover:null,images:[],existingImgCover:null,existingImages:[]}),le=a([]),se=a([]),ne=a(!1),de=a(!1),ue=a([{key:"title",type:"group",label:"Product Title",description:"Product title in different languages",groupClass:"grid grid-cols-1 md:grid-cols-2 gap-4",fields:[{key:"en",type:"text",label:"English Title",placeholder:"Enter product title in English",required:!0,validation:{minLength:1,maxLength:1e3}},{key:"ar",type:"text",label:"Arabic Title",placeholder:"Enter product title in Arabic",required:!0,validation:{minLength:1,maxLength:1e3}}]},{key:"description",type:"group",label:"Product Description",description:"Product description in different languages",groupClass:"grid grid-cols-1 md:grid-cols-2 gap-4",fields:[{key:"en",type:"textarea",label:"English Description",placeholder:"Enter product description in English",required:!0,rows:4,validation:{minLength:1,maxLength:1e3}},{key:"ar",type:"textarea",label:"Arabic Description",placeholder:"Enter product description in Arabic",required:!0,rows:4,validation:{minLength:1,maxLength:1e3}}]},{key:"price",type:"number",label:"Price",placeholder:"Enter product price",required:!0,min:.01,step:.01,validation:{min:.01,required:!0}},{key:"priceBeforeOffer",type:"number",label:"Price Before Offer",placeholder:"Enter price before offer (optional)",min:0,step:.01},{key:"quantity",type:"number",label:"Quantity",placeholder:"Enter available quantity",required:!0,min:0,validation:{min:0,required:!0}},{key:"category",type:"select",label:"Category",placeholder:"Select a category",required:!0,validation:{required:!0},options:e(()=>le.value.map(e=>{var t;return{value:e._id,label:(null==(t=e.name)?void 0:t.en)||e.name}})),loading:ne},{key:"subcategory",type:"select",label:"Subcategory",placeholder:"Select a subcategory",required:!0,validation:{required:!0},options:e(()=>se.value.map(e=>{var t,a;return{value:e._id,label:(null==(t=e.name)?void 0:t.en)||(null==(a=e.name)?void 0:a.ar)||e.name}})),loading:de},{key:"productCode",type:"text",label:"Product Code",placeholder:"Enter unique product code",required:!0,validation:{required:!0,minLength:1,maxLength:1e3}},{key:"tagsEn",type:"array",label:"English Tags",description:"Product tags for search and categorization (English)",fields:[{key:"tag",type:"text",placeholder:"Enter tag",required:!1}],allowAdd:!0,allowRemove:!0,addButtonText:"+ Add Tag",removeButtonText:"Remove",itemLabel:"Tag",emptyMessage:"No English tags added yet"},{key:"tagsAr",type:"array",label:"Arabic Tags",description:"Product tags for search and categorization (Arabic)",fields:[{key:"tag",type:"text",placeholder:"Enter tag",required:!1}],allowAdd:!0,allowRemove:!0,addButtonText:"+ Add Tag",removeButtonText:"Remove",itemLabel:"Tag",emptyMessage:"No Arabic tags added yet"},{key:"notesEn",type:"array",label:"English Notes",description:"Additional notes about the product (English)",fields:[{key:"note",type:"textarea",placeholder:"Enter product note",rows:3,required:!1}],allowAdd:!0,allowRemove:!0,addButtonText:"+ Add Note",removeButtonText:"Remove",itemLabel:"Note",emptyMessage:"No English notes added yet"},{key:"notesAr",type:"array",label:"Arabic Notes",description:"Additional notes about the product (Arabic)",fields:[{key:"note",type:"textarea",placeholder:"Enter product note",rows:3,required:!1}],allowAdd:!0,allowRemove:!0,addButtonText:"+ Add Note",removeButtonText:"Remove",itemLabel:"Note",emptyMessage:"No Arabic notes added yet"},{key:"imgCover",type:"file",label:"Cover Image",description:"Upload the main product cover image",accept:"image/*",required:e(()=>!Z.value||!oe.value.existingImgCover)},{key:"images",type:"file",label:"Product Images",description:"Upload additional product images (new images will be added to existing ones)",accept:"image/*",multiple:!0},{key:"isActive",type:"switch",label:"Active Status",hint:"Enable to make product visible to customers"},{key:"isFeatured",type:"switch",label:"Featured Product",hint:"Enable to highlight this product"},{key:"isInStock",type:"switch",label:"In Stock",hint:"Enable if product is currently in stock"},{key:"priority",type:"switch",label:"Priority Product",hint:"Enable to mark this product as priority (will appear first in listings)"}]),ce=async e=>{var t,a,r,i,o;if(e){de.value=!0;try{const i=await k.getAllSubcategories(e);se.value=(null==(a=null==(t=i.data)?void 0:t.data)?void 0:a.subcategories)||[],1!==se.value.length||oe.value.subcategory||(oe.value.subcategory=se.value[0]._id,console.log("âœ… [loadSubcategoriesByCategory] Auto-selected single subcategory:",(null==(r=se.value[0].name)?void 0:r.en)||se.value[0].name))}catch(l){console.error("âŒ [loadSubcategoriesByCategory] Error loading subcategories:",l),console.error("âŒ [loadSubcategoriesByCategory] Error response:",null==(i=l.response)?void 0:i.data),console.error("âŒ [loadSubcategoriesByCategory] Error status:",null==(o=l.response)?void 0:o.status),se.value=[]}finally{de.value=!1}}else se.value=[]},ge=async(e,t)=>{oe.value[e]=t,"category"===e&&(oe.value.subcategory="",t?await ce(t):se.value=[])},ve=async(e,t,a=null)=>{var r,i,o;if(confirm("Are you sure you want to delete this image?")){ie.value=e;try{await A.deleteImageById(e),"cover"===t?oe.value.existingImgCover=null:"additional"===t&&null!==a&&oe.value.existingImages.splice(a,1)}catch(l){console.error("âŒ [deleteExistingImage] Error deleting image:",l),console.error("âŒ [deleteExistingImage] Error response:",null==(r=l.response)?void 0:r.data),alert((null==(o=null==(i=l.response)?void 0:i.data)?void 0:o.message)||"Failed to delete image")}finally{ie.value=null}}},pe=async()=>{var e,t,a,r,i,o,l,s,n,d,u,c,g,p;if(Z.value){ee.value=!0,re.value="";try{const g=await w.getProductById(Y.value);if(null==(t=null==(e=g.data)?void 0:e.data)?void 0:t.product){const e=g.data.data.product;oe.value={title:{en:(null==(a=e.title)?void 0:a.en)||"",ar:(null==(r=e.title)?void 0:r.ar)||""},description:{en:(null==(i=e.description)?void 0:i.en)||"",ar:(null==(o=e.description)?void 0:o.ar)||""},price:e.price||0,priceBeforeOffer:e.priceBeforeOffer||0,quantity:e.quantity||0,category:(null==(l=e.category)?void 0:l._id)||e.category||"",subcategory:(null==(s=e.subcategory)?void 0:s._id)||e.subcategory||"",productCode:e.productCode||"",tagsEn:Array.isArray(null==(n=e.tags)?void 0:n.en)&&e.tags.en.length>0?e.tags.en.map(e=>({tag:e})):[],tagsAr:Array.isArray(null==(d=e.tags)?void 0:d.ar)&&e.tags.ar.length>0?e.tags.ar.map(e=>({tag:e})):[],notesEn:Array.isArray(null==(u=e.notes)?void 0:u.en)&&e.notes.en.length>0?e.notes.en.map(e=>({note:e})):[],notesAr:Array.isArray(null==(c=e.notes)?void 0:c.ar)&&e.notes.ar.length>0?e.notes.ar.map(e=>({note:e})):[],isActive:!1!==e.isActive,isFeatured:e.isFeatured||!1,isInStock:!1!==e.isInStock,priority:e.priority||!1,existingImgCover:e.imgCover||null,existingImages:e.images||[],imgCover:null,images:[]},await v(),oe.value.category&&await ce(oe.value.category)}}catch(m){re.value=(null==(p=null==(g=m.response)?void 0:g.data)?void 0:p.message)||"Failed to load product data"}finally{ee.value=!1}}},me=async e=>{var t,a,r,i,o,l,s;ae.value=!0,re.value="",console.log("ðŸ” [handleSubmit] Form data received:",e);try{re.value="";const l={title:{en:(null==(t=e.title)?void 0:t.en)||"",ar:(null==(a=e.title)?void 0:a.ar)||""},description:{en:(null==(r=e.description)?void 0:r.en)||"",ar:(null==(i=e.description)?void 0:i.ar)||""},price:Number(e.price),priceBeforeOffer:e.priceBeforeOffer?Number(e.priceBeforeOffer):void 0,quantity:Number(e.quantity),category:e.category,subcategory:e.subcategory,productCode:e.productCode,tags:{en:e.tagsEn?e.tagsEn.map(e=>e.tag).filter(e=>e&&e.trim()):[],ar:e.tagsAr?e.tagsAr.map(e=>e.tag).filter(e=>e&&e.trim()):[]},notes:{en:e.notesEn?e.notesEn.map(e=>e.note).filter(e=>e&&e.trim()):[],ar:e.notesAr?e.notesAr.map(e=>e.note).filter(e=>e&&e.trim()):[]},isActive:e.isActive,isFeatured:e.isFeatured,isInStock:e.isInStock,priority:e.priority};if(!l.title.en||!l.title.ar)throw new Error("Both English and Arabic titles are required");if(!l.description.en||!l.description.ar)throw new Error("Both English and Arabic descriptions are required");if(!l.category)throw new Error("Category is required");if(!l.subcategory)throw new Error("Subcategory is required");if(!l.productCode)throw new Error("Product code is required");if(l.price<=0)throw new Error("Price must be greater than 0");if(l.quantity<0)throw new Error("Quantity cannot be negative");let s;if(Z.value){const t=e.imgCover instanceof File?e.imgCover:void 0,a=e.images&&e.images.length>0&&e.images[0]instanceof File?e.images:void 0;s=await w.updateProduct(Y.value,l,t,a)}else{if(!(e.imgCover&&e.imgCover instanceof File))throw new Error("Cover image is required");s=await w.createProduct(l,e.imgCover,e.images||[])}"success"===(null==(o=s.data)?void 0:o.status)&&X.push("/products")}catch(n){re.value=(null==(s=null==(l=n.response)?void 0:l.data)?void 0:s.message)||n.message||"Failed to save product"}finally{ae.value=!1}},ye=()=>{Z.value?pe():oe.value={title:{en:"",ar:""},description:{en:"",ar:""},price:0,priceBeforeOffer:0,quantity:0,category:"",subcategory:"",productCode:"",tagsEn:[],tagsAr:[],notesEn:[],notesAr:[],isActive:!0,isFeatured:!1,isInStock:!0,priority:!1,imgCover:null,images:[],existingImgCover:null,existingImages:[]}};return r(async()=>{await(async()=>{var e,t,a;ne.value=!0;try{const a=await C.getAllCategories();le.value=(null==(t=null==(e=a.data)?void 0:e.data)?void 0:t.categories)||[]}catch(r){console.error("âŒ [loadCategories] Error loading categories:",r),console.error("âŒ [loadCategories] Error details:",null==(a=r.response)?void 0:a.data)}finally{ne.value=!1}})(),Z.value&&await pe()}),(e,t)=>(m(),i(b,null,{default:o(()=>[l(y,{pageTitle:$.value},null,8,["pageTitle"]),s("div",E,[l(h,{title:$.value},{default:o(()=>{var e,a;return[ee.value?(m(),n("div",I,[...t[1]||(t[1]=[s("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-brand-500 mx-auto"},null,-1),s("p",{class:"mt-2 text-gray-500"},"Loading product data...",-1)])])):re.value?(m(),n("div",_,[s("p",q,u(re.value),1),s("button",{onClick:pe,class:"mt-2 px-4 py-2 bg-brand-500 text-white rounded-lg hover:bg-brand-600"})])):d("",!0),Z.value&&(oe.value.existingImgCover||(null==(e=oe.value.existingImages)?void 0:e.length))?(m(),n("div",B,[t[6]||(t[6]=s("h3",{class:"text-lg font-medium mb-3 text-gray-700"},"Existing Images",-1)),oe.value.existingImgCover?(m(),n("div",P,[t[3]||(t[3]=s("h4",{class:"text-sm font-medium text-gray-600 mb-2"},"Cover Image",-1)),s("div",L,[l(x,{"image-id":"string"==typeof oe.value.existingImgCover?oe.value.existingImgCover:oe.value.existingImgCover._id,alt:oe.value.existingImgCover.originalName||"Cover image",width:"128px",height:"128px","image-class":"w-32 h-32 object-cover rounded border",placeholder:"/placeholder-product.png"},null,8,["image-id","alt"]),s("button",{onClick:t[0]||(t[0]=e=>ve("string"==typeof oe.value.existingImgCover?oe.value.existingImgCover:oe.value.existingImgCover._id,"cover")),type:"button",disabled:ie.value===oe.value.existingImgCover._id,class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1.5 hover:bg-red-600 transition-colors shadow-lg disabled:opacity-50",title:"Delete cover image"},[ie.value!==oe.value.existingImgCover._id?(m(),n("svg",j,[...t[2]||(t[2]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)])])):d("",!0)],8,S),"object"==typeof oe.value.existingImgCover?(m(),n("div",N,[s("p",T,u(oe.value.existingImgCover.originalName),1),s("p",F,"Size: "+u(Math.round(oe.value.existingImgCover.size/1024))+"KB",1)])):d("",!0)])])):d("",!0),(null==(a=oe.value.existingImages)?void 0:a.length)?(m(),n("div",M,[s("h4",z,"Additional Images ("+u(oe.value.existingImages.length)+") ",1),s("div",O,[(m(!0),n(c,null,g(oe.value.existingImages,(e,a)=>(m(),n("div",{key:"string"==typeof e?e:e._id,class:"relative"},[l(x,{"image-id":"string"==typeof e?e:e._id,alt:"object"==typeof e?e.originalName:"Product image",width:"100%",height:"96px","image-class":"w-full h-24 object-cover rounded border",placeholder:"/placeholder-product.png"},null,8,["image-id","alt"]),s("button",{onClick:t=>ve("string"==typeof e?e:e._id,"additional",a),type:"button",disabled:ie.value===e._id,class:"absolute -top-2 -right-2 bg-red-500 text-white rounded-full p-1.5 hover:bg-red-600 transition-colors shadow-lg disabled:opacity-50",title:"Delete image"},[ie.value!==e._id?(m(),n("svg",D,[...t[4]||(t[4]=[s("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"},null,-1)])])):(m(),n("svg",U,[...t[5]||(t[5]=[s("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),s("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)])]))],8,R),"object"==typeof e?(m(),n("p",V,u(e.originalName),1)):d("",!0)]))),128))])])):d("",!0),t[7]||(t[7]=s("div",{class:"text-sm text-gray-500 mb-4"},[s("p",null,"Note: Upload new images below to add more (existing images will be preserved). Delete unwanted images using the delete icon.")],-1))])):d("",!0),re.value?(m(),n("div",H,[s("div",Q,[t[9]||(t[9]=s("div",{class:"flex-shrink-0"},[s("svg",{class:"h-5 w-5 text-red-400",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},[s("path",{"fill-rule":"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z","clip-rule":"evenodd"})])],-1)),s("div",K,[t[8]||(t[8]=s("h3",{class:"text-sm font-medium text-red-800"},"Validation Error",-1)),s("div",G,[s("p",null,u(re.value),1)])])])])):d("",!0),(m(),i(f,{key:te.value,fields:ue.value,"initial-data":oe.value,"show-submit-button":!0,"submit-button-text":Z.value?"Update Product":"Create Product","show-reset-button":!0,loading:ae.value,"validate-on-submit":!0,"validate-on-change":!0,onSubmit:me,onReset:ye,onChange:ge},null,8,["fields","initial-data","submit-button-text","loading"]))]}),_:1},8,["title"])])]),_:1}))}};export{J as default};
