import{r as e,m as a,C as t,o as r,B as o,z as u,j as n,k as l,q as s,b as i,e as c}from"./index-BChQAjBg.js";import{_ as g}from"./PageBreadcrumb.vue_vue_type_script_setup_true_lang-CiMPynWi.js";import{_ as m}from"./AdminLayout-BDbNDvIA.js";import{_ as d}from"./ComponentCard.vue_vue_type_script_setup_true_lang-CxALZE3h.js";import{_ as y}from"./Form.vue_vue_type_script_setup_true_lang-Dj0hsM9h.js";import{S as v}from"./SubcategoriesAPI-C_blSPdt.js";import"./_plugin-vue_export-helper-BCo6x5W8.js";const p={class:"space-y-5 sm:space-y-6"},b={__name:"EditSubcategory",setup(b){const _=t(),f=o(),S=e(!1),h=e(null),E=a(()=>"new"!==_.params.id),A=a(()=>E.value?"Edit Subcategory":"Create Subcategory"),C=a(()=>E.value&&h.value&&h.value.category?h.value.category:!E.value&&_.query.category||_.query.category?_.query.category:_.params.categoryId?_.params.categoryId:null),I=[{key:"nameEn",type:"text",label:"Name (English)",placeholder:"Enter subcategory name in English",required:!0,validation:{minLength:2,maxLength:50}},{key:"nameAr",type:"text",label:"Name (Arabic)",placeholder:"Enter subcategory name in Arabic",required:!0,validation:{minLength:2,maxLength:50}}],q=e({nameEn:"",nameAr:""}),w=async()=>{if(E.value)try{if(console.log("Fetching subcategory data for subcategory ID:",_.params.id),console.log("Using category ID:",C.value),!C.value&&_.params.id){const a=(await CategoriesAPI.getAllCategories()).data.data.categories;for(const t of a)try{const e=await v.getAllSubcategories(t._id),a=e.data.data.getAllSubCategories.find(e=>e._id===_.params.id);if(a)return h.value=a,void(q.value={nameEn:a.name.en,nameAr:a.name.ar})}catch(e){console.log(`No subcategories found for category ${t._id}`)}return console.error("Subcategory not found in any category"),alert("Subcategory not found"),void f.push("/categories")}const a=await v.getAllSubcategories(C.value),t=a.data.data.getAllSubCategories.find(e=>e._id===_.params.id);t?(h.value=t,q.value={nameEn:t.name.en,nameAr:t.name.ar}):(console.error("Subcategory not found with ID:",_.params.id),alert("Subcategory not found"),f.push(`/categories/view/${C.value}`))}catch(a){console.error("[fetchSubcategory] Error fetching subcategory:",a),alert("Error loading subcategory data"),f.push("/categories")}},x=async e=>{S.value=!0;try{const a=localStorage.getItem("token"),t={en:e.nameEn,ar:e.nameAr};E.value?await v.updateSubcategory(C.value,_.params.id,{name:t},a):await v.createSubcategory(C.value,{name:t},a),f.push(`/categories/view/${C.value}`)}catch(a){console.error("[handleSubmit] Error saving subcategory:",a),alert("Error saving subcategory. Please try again.")}finally{S.value=!1}},j=()=>{E.value&&h.value?q.value={nameEn:h.value.name.en,nameAr:h.value.name.ar}:q.value={nameEn:"",nameAr:""}};return r(()=>{console.log("EditSubcategory mounted - route params:",_.params),console.log("EditSubcategory mounted - route query:",_.query),console.log("EditSubcategory mounted - isEdit:",E.value),console.log("EditSubcategory mounted - categoryId:",C.value),E.value?w():C.value||(alert("Category ID is required"),f.push("/categories"))}),u(C,e=>{console.log("CategoryId changed to:",e),E.value&&e&&!h.value&&w()}),(e,a)=>(c(),n(m,null,{default:l(()=>[s(g,{pageTitle:A.value},null,8,["pageTitle"]),i("div",p,[s(d,{title:A.value},{default:l(()=>[s(y,{fields:I,initialData:q.value,submitButtonText:E.value?"Update Subcategory":"Create Subcategory",loading:S.value,onSubmit:x,onReset:j},null,8,["initialData","submitButtonText","loading"])]),_:1},8,["title"])])]),_:1}))}};export{b as default};
